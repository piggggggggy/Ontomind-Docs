# Appendix — data/schemas v0.1 Starter Pack

> 바로 저장해서 쓸 수 있는 OML(TBox) + ABox 검증 스키마 템플릿,
> 파일 경로와 내용을 그대로 생성 시, dsl→IR→codegen 파이프라인에 바로 태우기 위함.\

```
data/
└─ schemas/
   ├─ ontomind.oml.yml              # OML 메인(TBox)
   ├─ tbox/
   │  ├─ classes.yml                # (선택) TBox 분리: 클래스들
   │  ├─ relations.yml              # (선택) TBox 분리: 관계유형들
   │  ├─ intents.yml                # (선택) 인텐트 정의
   │  └─ policies.yml               # (선택) 정책/컨텍스트
   ├─ abox.entity.schema.yml        # ABox: 엔티티 JSON Schema
   ├─ abox.relation.schema.yml      # ABox: 관계 JSON Schema
   └─ meta.schema.yml               # OML 자체 메타 스키마(문법 규정)
```

## 1) ontomind.oml.yml (OML 메인; TBox)

```yml
version: 0.1
namespaces: [core, project, people, fe, kb, intent, ctx, policy]

classes:
  - id: { ns: project, slug: project, version: "1.0.0" }
    label: Project
    description: 업무 프로젝트 개념
    properties:
      - id: { ns: core, slug: name, version: "1.0.0" }
        label: Name
        type: string
        required: true
      - id: { ns: project, slug: status, version: "1.0.0" }
        label: Status
        type: { enum: [draft, active, paused, done] }
        default: draft
      - id: { ns: core, slug: start-date, version: "1.0.0" }
        label: Start Date
        type: date
      - id: { ns: core, slug: end-date, version: "1.0.0" }
        label: End Date
        type: date
      - id: { ns: core, slug: goal, version: "1.0.0" }
        label: Goal
        type: markdown
    status: active

  - id: { ns: people, slug: person, version: "1.0.0" }
    label: Person
    description: 사람 엔티티
    properties:
      - id: { ns: core, slug: name, version: "1.0.0" }
        label: Display Name
        type: string
        required: true
      - id: { ns: people, slug: role, version: "1.0.0" }
        label: Role
        type: { enum: [fe, be, pm, designer, leader] }
      - id: { ns: people, slug: strengths, version: "1.0.0" }
        label: Strengths
        type: json
      - id: { ns: people, slug: cautions, version: "1.0.0" }
        label: Cautions
        type: json
    status: active

  - id: { ns: fe, slug: widget, version: "1.0.0" }
    label: Widget
    description: 대시보드 위젯 정의
    properties:
      - id: { ns: core, slug: name, version: "1.0.0" }
        label: Name
        type: string
        required: true
      - id: { ns: fe, slug: options, version: "1.0.0" }
        label: Options
        type: json
      - id: { ns: core, slug: version, version: "1.0.0" }
        label: Version
        type: string
    status: active

relationTypes:
  - id: { ns: core, slug: owns, version: "1.0.0" }
    label: owns
    domain: { ns: people, slug: person, version: "1.0.0" }
    range:  { ns: project, slug: project, version: "1.0.0" }
    cardinality: "1-N"

  - id: { ns: core, slug: depends-on, version: "1.0.0" }
    label: depends_on
    domain: { ns: project, slug: project, version: "1.0.0" }
    range:  { ns: project, slug: project, version: "1.0.0" }
    cardinality: "N-N"
    symmetric: false
    inverseOf: { ns: core, slug: depended-by, version: "1.0.0" }

  - id: { ns: fe, slug: uses-widget, version: "1.0.0" }
    label: uses_widget
    domain: { ns: project, slug: project, version: "1.0.0" }
    range:  { ns: fe, slug: widget, version: "1.0.0" }
    cardinality: "N-N"

intents:
  - id: { ns: intent, slug: summarize, version: "1.0.0" }
    label: Summarize
    input:  { scope: "json" }
    output: { summary: "markdown", highlights: "json" }

  - id: { ns: intent, slug: diagnose, version: "1.0.0" }
    label: Diagnose
    input:  { target: "id:Project" }
    output: { symptoms: "json", causes: "json", remedies: "json" }

contexts:
  - id: { ns: ctx, slug: workspace-admin, version: "1.0.0" }
    label: Workspace Admin Context
    role: me
    filters: { visibility: internal }

policies:
  - id: { ns: policy, slug: privacy-person, version: "1.0.0" }
    label: Privacy.Person
    forbid: ["leak_sensitive_personal_info"]
```

> 분리 운영을 원하면 tbox/*.yml로 나누고, CI에서 병합해 ontomind.oml.yml을 생성하는 방향도 검토

## 2) abox.entity.schema.yml (ABox 엔티티 검증)

```yml
$schema: "https://json-schema.org/draft/2020-12/schema"
$title: "OntoMind ABox Entity"
type: object
required: [id, class, data]
properties:
  id:
    type: string
    description: "namespace:Type/slug#version 형식 권장"
    pattern: "^[a-z][a-z0-9-]*:[A-Za-z][A-Za-z0-9-]*/[A-Za-z0-9._-]+(#[A-Za-z0-9._-]+)?$"
  class:
    type: object
    required: [ns, slug]
    properties:
      ns: { type: string }
      slug: { type: string }
      version: { type: string }
  data:
    type: object
    description: "TBox(Class.properties)에 정의된 속성값"
    additionalProperties: true
  status:
    type: string
    enum: [draft, active, deprecated]
  sources:
    type: array
    items: { type: string }
  confidence:
    type: number
    minimum: 0
    maximum: 1
  created_at: { type: string, format: date-time }
  updated_at: { type: string, format: date-time }
  visibility:
    type: string
    enum: [public, internal, private]
```

## 3) abox.relation.schema.yml (ABox 관계 검증)

```yml
$schema: "https://json-schema.org/draft/2020-12/schema"
$title: "OntoMind ABox Relation"
type: object
required: [type, from, to]
properties:
  type:
    type: object
    required: [ns, slug]
    properties:
      ns: { type: string }
      slug: { type: string }
      version: { type: string }
  from:
    type: string
    pattern: "^[a-z][a-z0-9-]*:[A-Za-z][A-Za-z0-9-]*/[A-Za-z0-9._-]+(#[A-Za-z0-9._-]+)?$"
  to:
    type: string
    pattern: "^[a-z][a-z0-9-]*:[A-Za-z][A-Za-z0-9-]*/[A-Za-z0-9._-]+(#[A-Za-z0-9._-]+)?$"
  sources:
    type: array
    items: { type: string }
  confidence:
    type: number
    minimum: 0
    maximum: 1
  created_at: { type: string, format: date-time }
  updated_at: { type: string, format: date-time }
```

## 4) meta.schema.yml (OML 자체 메타-스키마; 문법 검증)

```yml
$schema: "https://json-schema.org/draft/2020-12/schema"
$title: "OntoMind OML Meta-Schema"
type: object
required: [version, namespaces]
properties:
  version:
    type: number
    enum: [0.1]
  namespaces:
    type: array
    items: { type: string }
  classes:
    type: array
    items:
      type: object
      required: [id, label, properties]
      properties:
        id:
          type: object
          required: [ns, slug]
          properties:
            ns: { type: string }
            slug: { type: string }
            version: { type: string }
        label: { type: string }
        description: { type: string }
        properties:
          type: array
          items:
            type: object
            required: [id, label, type]
            properties:
              id:
                type: object
                required: [ns, slug]
                properties:
                  ns: { type: string }
                  slug: { type: string }
                  version: { type: string }
              label: { type: string }
              type:
                oneOf:
                  - { type: string }
                  - { type: object, required: [enum], properties: { enum: { type: array, items: { type: string } } } }
                  - { type: object, required: [ref], properties: { ref: { type: object, required: [ns, slug], properties: { ns: { type: string }, slug: { type: string }, version: { type: string } } } } }
              required: { type: boolean }
              default: {}
        status: { type: string, enum: [draft, active, deprecated] }
  relationTypes:
    type: array
    items:
      type: object
      required: [id, label, domain, range]
      properties:
        id:
          type: object
          required: [ns, slug]
          properties:
            ns: { type: string }
            slug: { type: string }
            version: { type: string }
        label: { type: string }
        domain:
          type: object
          required: [ns, slug]
          properties:
            ns: { type: string }
            slug: { type: string }
            version: { type: string }
        range:
          type: object
          required: [ns, slug]
          properties:
            ns: { type: string }
            slug: { type: string }
            version: { type: string }
        cardinality: { type: string, enum: ["1-1","1-N","N-N"] }
        inverseOf:
          type: object
          required: [ns, slug]
          properties:
            ns: { type: string }
            slug: { type: string }
            version: { type: string }
        symmetric: { type: boolean }
        transitive: { type: boolean }
  intents:
    type: array
    items:
      type: object
      required: [id, label, input, output]
      properties:
        id:
          type: object
          required: [ns, slug]
          properties:
            ns: { type: string }
            slug: { type: string }
            version: { type: string }
        label: { type: string }
        input: { type: object }
        output: { type: object }
  contexts:
    type: array
    items:
      type: object
      required: [id, label]
      properties:
        id:
          type: object
          required: [ns, slug]
          properties:
            ns: { type: string }
            slug: { type: string }
            version: { type: string }
        label: { type: string }
        role: { type: string, enum: [me, lead, coach, analyst] }
        filters: { type: object }
  policies:
    type: array
    items:
      type: object
      required: [id, label]
      properties:
        id:
          type: object
          required: [ns, slug]
          properties:
            ns: { type: string }
            slug: { type: string }
            version: { type: string }
        label: { type: string }
        forbid: { type: array, items: { type: string } }
        prefer: { type: array, items: { type: string } }
```

### 사용 팁

- `meta.schema.yml`로 OML 편집 PR에서 문법을 1차로 잡고, 파서단에서 **의미론(카디널리티/역관계/참조 무결성)**을 2차로 체크.
- `abox.*.schema.yml`은 **인스턴스 작성기(UI/CLI)**와 데이터 수집 파이프라인에서 공용으로 사용.
- 코드젠 결과(`data/generated/*.json`)는 Next/CLI가 직접 로드.

⸻

### Mini CI 예시(개념)

1. `ontomind.oml.yml` 변경 감지 → `meta.schema.yml`로 문법 검증
2. 파서로 OML→IR 변환 → 의미론 검증(카디널리티/역관계)
3. IR→generated/ 산출물 생성(JSON Schema, d.ts, prompt-summary)
4. `instances/*.jsonl`을 `abox.*.schema.yml`로 유효성 검사
5. 통과 시 머지
